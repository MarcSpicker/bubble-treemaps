!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("planck-js")):"function"==typeof define&&define.amd?define(["exports","planck-js"],n):n(t.d3=t.d3||{},t.planck)}(this,function(t,n){"use strict";function e(t,n,e){var i=[];return t.descendants().filter(function(t){return t.depth===n}).forEach(function(t){let r=t.descendants().filter(function(t){return!t.children}),c=t.ancestors().filter(function(t){return t.depth===n})[0];r.forEach(function(t){let n=t.path(c).slice(1,-1),i=n.reduce(function(t,n){return t+n.uncertainty},0),r=c.uncertainty/2,o=t!==c?c.uncertainty:0;t.contourPadding=(t.depth-c.depth)*e+i+r,t.planckPadding=(t.depth-c.depth)*e+i+o+5}),i.push({nodes:r,parent:c})}),i}function i(t,n,i,c){d3.pack().radius(function(t){return t.r}).size([i,c])(t);for(let o=t.height-1;o>=0;o--){let u=e(t,o,n);r(u,i,c)}}function r(t,e,i){let r=n.World({gravity:n.Vec2(0,0)}),o=[];t.forEach(function(t){o.push(c(t,r))});let u=r.createBody(n.Vec2(e/2,i/2));o.forEach(function(t){let e=n.DistanceJoint({frequencyHz:.9,dampingRatio:.001},u,u.getPosition(),t,t.getPosition());e.m_length=0,r.createJoint(e)});for(let t=0;t<1e3;++t)r.step(1/60,6,2);for(let t=r.getBodyList();t;t=t.getNext())for(let e=t.getFixtureList();e;e=e.getNext())if(e.getShape().getType()===n.Circle.TYPE){let n=t.getWorldPoint(e.getShape().getCenter()),i=e.getUserData();i.x=n.x,i.y=n.y}}function c(t,e){let i=0,r=n.Vec2.zero();t.nodes.forEach(function(t){let n=t.r*t.r*Math.PI;i+=n,r.x+=t.x*n,r.y+=t.y*n}),r.mul(1/i);let c=e.createDynamicBody(r),o={density:1,friction:1e-5};return t.nodes.forEach(function(t){let e=n.Vec2(t.x,t.y),i=e.sub(r);c.createFixture(n.Circle(i,t.r+t.planckPadding),o).setUserData(t)}),c}function o(t,n){let e=0;t.children.forEach(function(t){t.descendants().forEach(function(t){t.color=n[e%n.length]}),e++})}function u(t,n){this.x=t,this.y=n,this.distance=function(t){var n=this.x-t.x,e=this.y-t.y;return Math.sqrt(n*n+e*e)},this.sub=function(t){return new u(this.x-t.x,this.y-t.y)},this.add=function(t){return new u(this.x+t.x,this.y+t.y)},this.scale=function(t){return new u(this.x*t,this.y*t)},this.angle=function(t){var n=Math.atan2(t.y,t.x)-Math.atan2(this.y,this.x);return n<0&&(n+=2*Math.PI),n},this.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.toUnitVector=function(){return this.scale(1/this.magnitude())}}function s(t,n,e,i,r){this.center=new u(t,n),this.startAngle=e,this.endAngle=i,this.radius=r}function a(t,n,e){this.center=new u(t,n),this.radius=e,this.intersects=function(t){var n=this.center.distance(t.center);return!(n>this.radius+t.radius)&&!(n<Math.abs(this.radius-t.radius))},this.intersectionPoints=function(t){var n=this.center,e=t.center,i=this.center.distance(t.center),r=(this.radius*this.radius-t.radius*t.radius+i*i)/(2*i),c=Math.sqrt(this.radius*this.radius-r*r),o=e.sub(n).scale(r/i).add(n),s=o.x+c*(e.y-n.y)/i,a=o.y-c*(e.x-n.x)/i,h=o.x-c*(e.y-n.y)/i,f=o.y+c*(e.x-n.x)/i;return[new u(s,a),new u(h,f)]}}function h(t,n){let e=[];t.forEach(function(t){e.push(new a(t.x,t.y,t.r+t.contourPadding))});let i=d(e,n),r=[];return r=r.concat(l(i)),r=r.concat(g(i,n)),y(r)}function f(t,n,e){let i=n[t],r=[];for(let e=0;e<n.length;e++)if(e!==t&&n[e].intersects(n[t])){let i=n[e].intersectionPoints(n[t]);r.push({intersectionPoint:i[0],circleIndex:e}),r.push({intersectionPoint:i[1],circleIndex:e})}let c=7,o=void 0;return r.forEach(function(t){let n=e.angle(t.intersectionPoint.sub(i.center));n>P&&n<c&&(c=n,o=t)}),o}function d(t,n){let e=t.map(function(t){return Object.assign({},t)});e.forEach(function(t){t.radius+=n});let i=0;for(let t=1;t<e.length;t++)e[t].center.x-e[t].radius<e[i].center.x-e[i].radius&&(i=t);let r=[],c=i,o=new u(-1,0);for(;;){let n=f(c,e,o);if(void 0===n)break;c=n.circleIndex;let i=t[c];if(o=n.intersectionPoint.sub(i.center),r[0]&&c===r[0].circleIndex&&n.intersectionPoint.distance(r[0].intersectionPoint)<P)break;r.push({circle:i,intersectionPoint:n.intersectionPoint,circleIndex:c})}return r}function l(t){let n=[];for(let e=0;e<t.length;e++){let i=t[e].circle,r=t[e].intersectionPoint,c=t[(e+1)%t.length].intersectionPoint,o=r.sub(i.center),a=c.sub(i.center),h=new u(0,-1).angle(o),f=new u(0,-1).angle(a);n.push(new s(i.center.x,i.center.y,h,f,i.radius))}return n}function g(t,n){let e=[];for(let i=0;i<t.length;i++){let r=t[i].intersectionPoint,c=t[i>0?i-1:t.length-1].circle,o=t[i].circle,a=c.center.sub(r),h=o.center.sub(r),f=new u(0,-1).angle(a),d=new u(0,-1).angle(h);e.push(new s(r.x,r.y,d,f,n))}return e}function y(t){let n=[],e=d3.arc();return t.forEach(function(t){let i=t.startAngle;i>t.endAngle&&(i-=2*Math.PI),n.push({d:e({innerRadius:t.radius,outerRadius:t.radius,startAngle:i,endAngle:t.endAngle}),transform:"translate("+t.center.x+","+t.center.y+")"})}),n}function x(t,n,i){let r=[];for(let c=t.height-1;c>=0;c--){let o=e(t,c,n);o.forEach(function(t){let n=h(t.nodes,i);n.forEach(function(n){n.strokeWidth=t.parent.uncertainty}),r=r.concat(n)})}return r}function p(){let t,n=10,e=10,r=[],c=800,u=800,s=[];return t={doColoring:function(){return o(s,r),t},doLayout:function(){return i(s,n,c,u),t},getContour:function(){return x(s,n,e)},hierarchyRoot:function(n){return arguments.length?(n.descendants().forEach(function(t){t.r||(t.r=t.value),t.uncertainty||(t.uncertainty=t.data.uncertainty)}),s=n,t):s},padding:function(e){return arguments.length?(n=+e,t):n},width:function(n){return arguments.length?(c=+n,t):c},height:function(n){return arguments.length?(u=+n,t):u},curvature:function(n){return arguments.length?(e=+n,t):e},colormap:function(n){return arguments.length?(r=n,t):r}}}let P=1e-5;t.bubbletreemap=p,Object.defineProperty(t,"__esModule",{value:!0})});